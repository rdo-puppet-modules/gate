---
- defaults:
    name: global
    logrotate:
        daysToKeep: 30
        numToKeep: 50
        artifactDaysToKeep: 30
        artifactNumToKeep: 50
    node: openstack-puppet-ci-slave01
    wrappers:
        - ansicolor
        - timestamps
        - workspace-cleanup

- scm:
    name: gate-scripts
    scm:
        - git:
            name: ci-scripts
            basedir: ci-scripts
            url: https://github.com/rdo-puppet-modules/ci-scripts.git

- scm:
    name: original-project
    scm:
        - git:
            name: original
            refspec: $GERRIT_REFSPEC
            url: ssh://openstack-gerrit/$GERRIT_PROJECT
            branches: $GERRIT_BRANCH
            choosing-strategy: gerrit
            basedir: $GERRIT_PROJECT

- scm:
    name: khaleesi
    scm:
        - git:
            refspec: +refs/changes/*:refs/remotes/origin/changes/*
            url: https://github.com/redhat-openstack/khaleesi.git
            branches: changes/59/232059/96
            basedir: khaleesi

- scm:
    name: khaleesi-settings
    scm:
        - git:
            url: https://github.com/redhat-openstack/khaleesi-settings.git
            basedir: khaleesi-settings

- scm:
    name: replica-project
    scm:
        - git:
            name: replica
            refspec: $GERRIT_REFSPEC
            url: ssh://gerrithub/$GERRIT_PROJECT
            branches: $GERRIT_BRANCH
            choosing-strategy: gerrit
            basedir: $GERRIT_PROJECT

- trigger:
    name: daily-once
    triggers:
        - timed: '@daily'

- trigger:
    name: upstream-gerrit-merge-event
    triggers:
        - gerrit:
            server-name: Openstack_rdo-ci-service
            silent: true
            trigger-on:
                - change-merged-event
            projects:
                - project-compare-type: 'PATH'
                  project-pattern: openstack/puppet-*
                  branches:
                      - branch-compare-type: 'PLAIN'
                        branch-pattern: 'master'
                  skip-vote:
                      successful: true
                      failed: true
                      unstable: true
                      notbuilt: true

- trigger:
    name: replica-gerrit-recombination-merge-event
    triggers:
        - gerrit:
            server-name: Gerrithub-nonvoting_rdo-ci-service
            silent: true
            trigger-on:
                - change-merged-event
            projects:
                - project-compare-type: 'PATH'
                  project-pattern: rdo-puppet-modules/puppet-*
                  branches:
                      - branch-compare-type: 'PLAIN'
                        branch-pattern: 'recomb-*'
                  skip-vote:
                      successful: true
                      failed: true
                      unstable: true
                      notbuilt: true

- trigger:
    name: replica-gerrit-patches-create-event
    triggers:
        - gerrit:
            server-name: GerritHub_rdo-ci-service
            silent: true
            trigger-on:
                - patchset-created-event:
                    exclude-drafts: true
                    exclude-trivial-rebase: false
                    exclude-no-code-change: true
            projects:
                - project-compare-type: 'PATH'
                  project-pattern: rdo-puppet-modules/puppet-*
                  branches:
                      - branch-compare-type: 'PLAIN'
                        branch-pattern: '*-patches'
                  skip-vote:
                      successful: true
                      failed: true
                      unstable: true
                      notbuilt: true

- trigger:
    name: replica-gerrit-recombination-create-event
    triggers:
        - gerrit:
            server-name: GerritHub_rdo-ci-service
            silent: true
            trigger-on:
                - patchset-created-event:
                    exclude-drafts: true
                    exclude-trivial-rebase: false
                    exclude-no-code-change: true
            projects:
                - project-compare-type: 'PATH'
                  project-pattern: rdo-puppet-modules/puppet-*
                  branches:
                      - branch-compare-type: 'PLAIN'
                        branch-pattern: 'recomb-*'
                  skip-vote:
                      successful: true
                      failed: true
                      unstable: true
                      notbuilt: true

- trigger:
    name: replica-gerrit-original-recombination-vote-event
    triggers:
        - gerrit:
            server-name: Gerrithub-nonvoting_rdo-ci-service
            silent: true
            trigger-on:
                - comment-added-event:
                    approval-category: 'Code-review'
                    approval-value: 2
                - comment-added-event:
                    approval-category: 'Verified'
                    approval-value: 1
            projects:
                - project-compare-type: 'PATH'
                  project-pattern: rdo-puppet-modules/puppet-*
                  branches:
                      - branch-compare-type: 'PLAIN'
                        branch-pattern: 'recomb-original-*'
                  skip-vote:
                      successful: true
                      failed: true
                      unstable: true
                      notbuilt: true

- trigger:
    name: replica-gerrit-patches-recombination-vote-event
    triggers:
        - gerrit:
            server-name: Gerrithub-nonvoting_rdo-ci-service
            silent: true
            trigger-on:
                - comment-added-event:
                    approval-category: 'Code-review'
                    approval-value: 2
                - comment-added-event:
                    approval-category: 'Verified'
                    approval-value: 1
            projects:
                - project-compare-type: 'PATH'
                  project-pattern: rdo-puppet-modules/puppet-*
                  branches:
                      - branch-compare-type: 'PLAIN'
                        branch-pattern: 'recomb-patches-*'
                  skip-vote:
                      successful: true
                      failed: true
                      unstable: true
                      notbuilt: true

